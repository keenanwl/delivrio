<app-dvo-card *ngIf="locationsEdit$|async; let loc">
	<div class="header">
		<h3 *ngIf="!!loc.locationID">Edit location</h3>
		<h3 *ngIf="!loc.locationID">Create a new location</h3>
		<span class="spacer"></span>
		<button mat-fab extended color="primary" (click)="save()">
			<mat-icon>checkmark</mat-icon>
			Save
		</button>
	</div>

	<div class="container">
		<form #form [formGroup]="editForm" ngxsFormArray="locationEdit.locationEditForm" class="column-container">
			<div class="column">
				<div class="row right-margin">
					<mat-form-field>
						<mat-label>Location name</mat-label>
						<input formControlName="name" matInput />
						<mat-error *ngIf="editForm.controls.name.invalid">
							{{editForm.controls.name.errors}}
						</mat-error>
					</mat-form-field>
					<ng-container formGroupName="address">
						<mat-form-field>
							<mat-label>Email</mat-label>
							<input formControlName="email" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.email.invalid">
								{{editForm.controls.address.controls.email.errors}}
							</mat-error>
						</mat-form-field>
					</ng-container>
				</div>
				<ng-container formGroupName="address">
					<div class="row right-margin">
						<mat-form-field>
							<mat-label>First name</mat-label>
							<input formControlName="firstName" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.firstName.invalid">
								{{editForm.controls.address.controls.firstName.errors}}
							</mat-error>
						</mat-form-field>
						<mat-form-field>
							<mat-label>Last name</mat-label>
							<input formControlName="lastName" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.lastName.invalid">
								{{editForm.controls.address.controls.lastName.errors}}
							</mat-error>
						</mat-form-field>
					</div>
					<div class="row right-margin">
						<mat-form-field>
							<mat-label>Address</mat-label>
							<input formControlName="addressOne" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.addressOne.invalid">
								{{editForm.controls.address.controls.addressOne.errors}}
							</mat-error>
						</mat-form-field>
						<mat-form-field>
							<mat-label>Address 2</mat-label>
							<input formControlName="addressTwo" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.addressTwo.invalid">
								{{editForm.controls.address.controls.addressTwo.errors}}
							</mat-error>
						</mat-form-field>
					</div>
					<div class="row right-margin">
						<mat-form-field>
							<mat-label>City</mat-label>
							<input formControlName="city" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.city.invalid">
								{{editForm.controls.address.controls.city.errors}}
							</mat-error>
						</mat-form-field>
						<mat-form-field>
							<mat-label>Zip</mat-label>
							<input formControlName="zip" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.zip.invalid">
								{{editForm.controls.address.controls.zip.errors}}
							</mat-error>
						</mat-form-field>
					</div>
					<div class="row right-margin">
						<mat-form-field>
							<mat-label>Company</mat-label>
							<input formControlName="company" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.company.invalid">
								{{editForm.controls.address.controls.company.errors}}
							</mat-error>
						</mat-form-field>
						<mat-form-field>
							<mat-label>State</mat-label>
							<input formControlName="state" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.state.invalid">
								{{editForm.controls.address.controls.state.errors}}
							</mat-error>
						</mat-form-field>
					</div>
					<div class="row right-margin">
						<mat-form-field>
							<mat-label>Country</mat-label>
							<mat-chip-grid #chipList>
								<mat-chip-row color="primary">
									{{editForm.controls.address.controls.country.controls.label.value}}
									({{editForm.controls.address.controls.country.controls.alpha2.value}})
								</mat-chip-row>
							</mat-chip-grid>
							<input placeholder="Type to search..."
							       #countriesInputRecipient
								   [matAutocomplete]="countriesAutoRecipient"
								   [matChipInputFor]="chipList"
								   (keyup)="searchCountries(countriesInputRecipient.value)">
							<mat-autocomplete #countriesAutoRecipient="matAutocomplete" (optionSelected)="countriesInputRecipient.value = ''; changeCountry($event.option.value)">
								<mat-option *ngFor="let country of loc.searchCountries" [value]="country">
									{{country.label}} ({{country.alpha2}})
								</mat-option>
							</mat-autocomplete>
						</mat-form-field>
					</div>

					<div class="row right-margin">
						<mat-form-field>
							<mat-label>Phone number</mat-label>
							<input formControlName="phoneNumber" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.phoneNumber.invalid">
								{{editForm.controls.address.controls.phoneNumber.errors}}
							</mat-error>
						</mat-form-field>
						<mat-form-field>
							<mat-label>VAT number</mat-label>
							<input formControlName="vatNumber" matInput />
							<mat-error *ngIf="editForm.controls.address.controls.vatNumber.invalid">
								{{editForm.controls.address.controls.vatNumber.errors}}
							</mat-error>
						</mat-form-field>
					</div>
				</ng-container>
			</div>
			<div class="column">
				<h4>Tags</h4>
				<mat-selection-list #tagList multiple="true" (selectionChange)="tagsChanged(tagList.selectedOptions.selected)">
					<ng-container *ngFor="let tag of loc.locationTags; let last = last">
						<mat-list-option [value]="tag"
										 [selected]="isTagSelected(tag.id, loc.locationEditForm.model?.locationTags)">
							{{tag.label}}
						</mat-list-option>
						<mat-divider *ngIf="!last"></mat-divider>
					</ng-container>
				</mat-selection-list>
			</div>
		</form>
	</div>
</app-dvo-card>

