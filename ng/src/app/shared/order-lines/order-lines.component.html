<div class="package-info" [class.is-dragging]="showDragBoundary">
	<div class="table-title">
		<ng-content></ng-content>
	</div>
	<mat-divider></mat-divider>
	<table mat-table [dataSource]="orderLines" [trackBy]="trackByRows" fixedLayout="true">

		<ng-container matColumnDef="units">
			<th mat-header-cell *matHeaderCellDef>Units</th>
			<td mat-cell *matCellDef="let element; let index = index">
				<ng-container *ngIf="editable">
					<input class="field-input"
					       #units
						   [disabled]="element.shipmentOrderLines?.length > 0"
						   (keyup)="unitsUpdated(index, units.value)"
						   [value]="element.units"/>
				</ng-container>
				<ng-container *ngIf="!editable">
					{{element.units}}
				</ng-container>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<ng-container matColumnDef="description">
			<th mat-header-cell *matHeaderCellDef>Description</th>
			<td mat-cell *matCellDef="let element">
				<a [routerLink]="productEditPath" [queryParams]="{id: element.productVariant.product.id}">
					{{element.productVariant.product.title}} - {{element.productVariant.description}} {{element.productVariant.archived ? "[Archived variant]" : ""}}
				</a>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<ng-container matColumnDef="unitPrice">
			<th mat-header-cell *matHeaderCellDef>Unit price</th>
			<td mat-cell *matCellDef="let element; let index = index">
				<ng-container *ngIf="editable">
					<input class="field-input"
						   #price
						   (keyup)="priceUpdated(index, price.value)"
						   [value]="element.unitPrice"/>
				</ng-container>
				<ng-container *ngIf="!editable">
					{{element.unitPrice}}
				</ng-container>
				{{element.currency.display}}
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<ng-container matColumnDef="discountAmount">
			<th mat-header-cell *matHeaderCellDef>Total discount</th>
			<td mat-cell *matCellDef="let element; let index = index">
				<ng-container *ngIf="editable">
					<input class="field-input"
						   #discount
						   (keyup)="discountUpdated(index, discount.value)"
						   [value]="element.discountAllocationAmount"/>
				</ng-container>
				<ng-container *ngIf="!editable">
					{{element.discountAllocationAmount}}
				</ng-container>
				{{element.currency.display}}
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<ng-container matColumnDef="weight">
			<th mat-header-cell *matHeaderCellDef>Unit weight (grams)</th>
			<td mat-cell *matCellDef="let element">{{element.productVariant.weightG}}</td>
			<td mat-footer-cell
				*matFooterCellDef
				class="total"
				[matTooltipTouchGestures]="'on'"
				[matTooltip]="'Total kg/lb:'+ (orderLines | totalWeight)">Total kg/lb: {{ orderLines | totalWeight }}
			</td>
		</ng-container>

		<ng-container matColumnDef="actions">
			<th mat-header-cell *matHeaderCellDef>Actions</th>
			<td mat-cell *matCellDef="let element; let index = index">
				<button mat-icon-button (click)="lineDelete(index)">
					<mat-icon>delete</mat-icon>
				</button>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<ng-container matColumnDef="drag">
			<th mat-header-cell *matHeaderCellDef></th>
			<td mat-cell *matCellDef="let element; let index = index">
				<mat-icon class="drag-handle-icon">drag_handle</mat-icon>
			</td>
			<td mat-footer-cell *matFooterCellDef></td>
		</ng-container>

		<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
		<!-- inline CSS required for D&D background color -->
		<tr mat-row
			cdkDrag
			[cdkDragDisabled]="!dragable"
			(cdkDragStarted)="dragStart()"
			(cdkDragEnded)="dragEnd()"
			style="background: white"
			class="row-container"
			[cdkDragData]="row.id"
			*matRowDef="let row; columns: displayedColumns;"
			(click)="edit(row)">
		</tr>
		<tr mat-footer-row *matFooterRowDef="displayedColumns">
		</tr>
	</table>
</div>
