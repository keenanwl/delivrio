package gengql

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.48

import (
	"context"

	"delivrio.io/go/ent/changehistory"
	"delivrio.io/go/ent/systemevents"
	"delivrio.io/go/gengql/generated/models"
	"entgo.io/ent/dialect/sql"
)

// HistoryLogs is the resolver for the historyLogs field.
func (r *queryResolver) HistoryLogs(ctx context.Context) (*models.HistoryLog, error) {
	allChanges, err := r.client.ChangeHistory.Query().
		Limit(20).
		Order(changehistory.ByID(sql.OrderDesc())).
		All(ctx)
	if err != nil {
		return nil, err
	}

	allSystemEvents, err := r.client.SystemEvents.Query().
		Limit(20).
		Order(systemevents.ByID(sql.OrderDesc())).
		All(ctx)
	if err != nil {
		return nil, err
	}

	return &models.HistoryLog{Histories: allChanges, SystemEvent: allSystemEvents}, nil
}
